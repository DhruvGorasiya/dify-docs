---
title: 性能调优
Version: '简体中文'
---

## 显示 Helm Chart 值
```bash
helm show values dify/dify
```

## 1. 提高资源分配
- 你可以通过调整 Helm Chart 中 `api`、`worker` 和 `plugin_daemon` 服务的资源分配来提升 Dify 的性能。
- 可根据你的部署环境和资源情况进行扩容。

```yaml
api:
  replicas: 3
  serverWorkerAmount: 1
  resources:
    limits:
      cpu: 3000m
      memory: 10240Mi
    requests:
      cpu: 1500m
      memory: 5120Mi
worker:
  replicas: 3
  celeryWorkerAmount: 1
  resources:
    limits:
      cpu: 2000m
      memory: 10240Mi
    requests:
      cpu: 1000m
      memory: 5120Mi
plugin_daemon:
  replicas: 3
  resources:
    limits:
      cpu: 1000m
      memory: 3072Mi
    requests:
      cpu: 500m
      memory: 1536Mi
```

## 2. 优化外部 Postgres 数据库性能
- 如果你使用外部的 Postgres 数据库，可以通过修改 `postgresql.conf` 配置文件来提升性能：
  - `max_connections`：建议根据你的负载将该值设置为 `2000` 或更高。

## 3. `api` 与 `worker` 服务优化
- 你可以根据环境和资源情况调整服务的工作进程数量。
  ```yaml
  api:
    serverWorkerAmount: 1
  worker:
    celeryWorkerAmount: 1
  ```

- `celeryWorkerAmount`：表示 `worker` 服务中 `Celery` 的工作进程数量。
  - 设置建议：
    - **生产环境**：设置为 CPU 核数。
    - **测试环境**：设置为 `1`，节省资源。
  - [参考文档：Celery CLI 参数说明](https://docs.celeryq.dev/en/stable/reference/cli.html#cmdoption-celery-worker-c)

- `serverWorkerAmount`：表示 `api` 服务中 `Gunicorn` 的工作进程数量。
  <Warning>
  建议将该值设置为 `1`。如果设置大于 `1`，请确保你的 `api` 服务能够承载更高的并发。
  </Warning>
  - 设置建议：
    - 一般设置为 `CPU 核心数 x 2 + 1`
  - [参考文档：Gunicorn Worker 数量计算](https://docs.gunicorn.org/en/stable/design.html#how-many-workers)
