---
title: Performance Tuning
Version: 'English'
---

## Display Helm Chart Values
```bash
helm show values dify/dify
```

## 1. Improve Resource Allocation
- You can improve the performance of Dify by adjusting the resource allocation for `api`, `worker`, and `plugin_daemon` services in the Helm chart values file.
- You can increase these values based on your environment and available resources.

```yaml
api:
  replicas: 3
  serverWorkerAmount: 1
  resources:
    limits:
      cpu: 3000m
      memory: 10240Mi
    requests:
      cpu: 1500m
      memory: 5120Mi
worker:
  replicas: 3
  celeryWorkerAmount: 1
  resources:
    limits:
      cpu: 2000m
      memory: 10240Mi
    requests:
      cpu: 1000m
      memory: 5120Mi
plugin_daemon:
  replicas: 3
  resources:
    limits:
      cpu: 1000m
      memory: 3072Mi
    requests:
      cpu: 500m
      memory: 1536Mi
``` 

## 2. Improve `External postgres` Performance
- If you are using an external Postgres database, you can improve the performance by adjusting the following parameters in the `postgresql.conf` file:
  - `max_connections`: Set to `2000` or higher based on your environment.

## 3. `api` and `worker` Services
- You can set the number of workers based on your environment and available resources.

```yaml
api:
  serverWorkerAmount: 1
worker:
  celeryWorkerAmount: 1
```

- `celeryWorkerAmount`: The number of `Celery` workers for `worker` service.
  - How to calculate:
    - If you are in production environment, you can set it to `number of cpu cores`.
    - If you are in testing environment, you can set it to `1` to save resources.
  - [Reference: https://docs.celeryq.dev/en/stable/reference/cli.html#cmdoption-celery-worker-c](https://docs.celeryq.dev/en/stable/reference/cli.html#cmdoption-celery-worker-c)

- `serverWorkerAmount`: The number of `Gunicorn` workers for `api` service.
  <Warning>
  We recommend setting the number of workers to `1`. If you set it to a value greater than `1`, you need to ensure that your `api` service can handle the increased load.
  </Warning>
  - How to calculate:
    - You can set it to `number of cpu cores x 2 + 1`.
  - [Reference: https://docs.gunicorn.org/en/stable/design.html#how-many-workers](https://docs.gunicorn.org/en/stable/design.html#how-many-workers)