---
title: 创建知识库流水线
---

知识库流水线是构建处理文档流程的一种解决方案，你能够像编排工作流一样对不同节点进行可视化地组合和配置，并选择使用不同工具来优化数据处理过程。

它主要包含四个环节，每个环节由不同的节点和工具组成，形成完整的数据处理链路：

**数据源 → 数据提取 → 数据处理 → 知识库存储**

每个步骤都有特定的用途：从各种来源收集内容，将其转换为可处理的文本，优化以便搜索，并以能够快速、准确检索的格式进行存储。

此外，Dify 还提供不同使用场景的知识流水线模板，帮助提升数据索引和检索结果的准确度。本章节将帮助你了解知识库流水线的创建方式、流程以及相应节点，让你能快速搭建和优化自己的知识库。

## 步骤一：通过知识流水线创建知识库

点击顶部的**知识库**，在左侧点击**通过知识流水线创建知识库**，你可以通过以下 3 种方式来创建知识流水线。

### 方式一：从零开始构建

点击**空白知识流水线**即可从零开始构建自定义知识流水线。
如果你需要根据数据特点和业务需求自定义处理策略，建议选择从空白知识流水线开始。

### 方式二：导入 DSL

Dify DSL 是一种基于 YAML 格式的应用工程文件标准，用于定义 AI 应用的各项配置，包括模型参数、提示词设计和工作流编排，帮助使用者能够通过使用 DSL 快速复用或者修改。与工作流 DSL 类似，知识库流水线基于相同的 YAML 格式标准，用于定义知识库内的处理流程和配置。

在完成知识库流水线的编排后，你可以保存和导出 DSL，并分享给其他人。知识库使用者可以导入知识流水线 DSL，快速复用已构建的知识流水线，并在此基础上针对不同情景或需求进行修改。知识流水线 DSL 包含以下内容：

| 名称          | 包含                         |
|--------------|------------------------------|
| 数据源        | 文件上传、网站、在线文档和在线网盘 |
| 数据处理流程   | 文档提取、内容分块和清洗策略      |
| 知识库储存配置 | 索引方式、检索设置和存储参数      |
| 节点连接      | 节点间的连接和处理顺序           |
| 用户输入表单   | 自定义的参数输入字段（如有配置）   |

### 方式三：通过模版创建

Dify 提供了两种模版方案： **内置流水线**（Built-in) 和**自定义** （Customized)。两种模版的卡片信息都包含了知识库名称、简介描述和标签（包含分段模式）。

#### 内置流水线（Built-in Pipeline)

内置流水线为预置的知识库流水线模版，针对常见的文档数据结构进行优化，你可以根据不同的文档类型和使用场景选择适合的处理方式。点击**选择**即可开始使用。

##### 模版类型

| 模版名称 | 分段结构 | 索引方式 | 检索设置 | 说明 |
|---------|---------|---------|---------|------|
| 通用模式（General Mode） | 通用模式 | 经济 | 倒排索引 | 将文档内容分割成较小的段落块（通用块），直接用于匹配用户查询和检索。 |
| 父子模式（Parent-child Structure) | 父子模式 | 高质量 | 混合检索 | 采用了高级分块策略，将文档文本分成较大的"父块"和较小的"子块"。其中，"父块"包含了"子块"。这样既保证了检索的精确性，又维持了上下文的完整性。 |
| 简单问答（Simple Q&A) | 问答模式 | 高质量 | 向量搜索 | 将表格数据转化为一问一答的形式，通过问题匹配来快速找到对应的答案信息。适用于结构化表格数据。 |
| 复杂 PDF （含图片和表格）（Complex PDF with Images & Tables） | 父子模式 | 高质量 | 混合检索 - 加权评分 | 提取 PDF 文件内的图像和表格内容。 |
| LLM 上下文增强（Contextual Enriching Using LLM) | 父子模式 | 高质量 | 混合检索 - 加权评分 | 将文档内的图片和表格提取出来，使用大型语言模型自动生成描述性注释，实现上下文的智能增强。 |
| Markdown 转换（Convert to Markdown) | 父子模式 | 高质量 | 混合检索 - 加权评分 | 专为 DOCX、XLSX 和 PPTX 等 Office 原生文件格式设计，将其转换为 Markdown 格式以便更好地进行信息处理。⚠️ 注意：不推荐使用 PDF 文件。 |
| LLM 生成问答（LLM Generated Q&A) | 问答模式 | 高质量 | 向量搜索 - 加权评分 | 使用大型语言模型自动生成结构化的问答对，通过问题匹配机制找到相关的答案信息。 |

点击模版卡片上的详情按钮，即可在弹窗中预览选中的流水线的编排结构、流水线简介和分段模式。点击使用此知识流水线模版进行编排。

#### 自定义（Customized）

自定义模版为用户创建和发布为知识流水线的方案，你可以选择使用该模版、导出 DSL，或点击详情进行快速预览。

点击模版卡片上的选择按钮，即可从该自定义模版开始创建知识库。你也可以在预览该流水线模版时，点击右侧的使用此知识流水线按钮开始创建。点击 ... 可以编辑流水线信息、导出 DSL 或者删除模版。

## 步骤二： 编排知识流水线
你可以将这一步理解为设计用于处理不同类型内容的工作流。在这里，你可以通过可视化的方式进行构建、调整和调试整个知识库流水线上的每个节点。

### 界面状态
进入知识库流水线编排界面时，你会看到：
- **标签页状态**：Documents（文档）、Retrieval Test（召回测试）和 Settings（设置）标签页将显示为置灰且不可用状态
- **必要步骤**：您必须完成知识库流水线的配置、调试和发布后，才能上传文件或使用其他功能

### 流水线编排

在编排界面，你可以对知识流水线进行配置和调试。
<Warning>
你可前往[编排知识流水线编排](TODO)文档，了解详细编排指引。
</Warning>

如果你选择了**空白知识流水线**，你将看到仅包含知识库节点的画布。你可以跟随该节点旁的指引，逐步完成流水线创建。

如果选择**特定的流水线模版**，编排界面将直接显示该流水线模版。

### 用户输入字段

此外，你还可以创建**用户输入字段**表单，用于定义和收集流水线执行过程中所需的变量。用户可以自定义字段类型，让知识库使用的人员在上传文件时可以自行填写参数，满足不同数据源或文档的处理需求。

### 为知识库命名
默认情况下，知识库名称为"Untitled + 序号”，权限设置为"仅自己可见”，图表为橙色书本。如果你使用 DSL文件导入，则将使用其保存的图标。

点击左侧面板中的设置并填写以下信息：
- **名称和图标** 
为你的知识库命名。你还可以选择一个 emoji、上传图片或粘贴图片 URL 作为知识库的图标。
- **知识库描述**
  简要描述您的知识库。这有助于 AI 更好地理解和检索您的数据。如果留空，Dify 将应用默认的检索策略。
- **权限** 
  从下拉菜单中选择适当的访问权限。

## 步骤三：发布知识流水线

完成知识库流水线的编排和调试后，点击**发布**并在弹窗中点击**确认**，即成功发布知识库流水线。
<Warning>
**注意：知识流水线发布后，分段结构无法进行修改。**
由于分段结构会影响知识库的存储方式和检索召回策略，为确保数据一致性和用户体验，当前每个知识库仅支持**一种分段结构**。
</Warning>

成功发布后，你可以点击**发布为知识流水线**将该流水线保存为可复用的模版，该模版将出现在自定义模版中。
<Warning>
限制说明：Sandbox 不支持发布为知识流水线功能。如需保存并发布为知识流水线，请升级至 Professional 或者 Team 方案。
</Warning>

## 步骤四：上传文件
完成知识库流水线的编排、调试并发布成功后，你能通过以下两种方式上传文件：
   A. 在发布成功的弹窗哪点击前往文档。进入文档页面后，点击添加文件进行上传。
   B. 在发布的下拉菜单中，点击去添加文档。进入选择数据源页面，选择对应数据源开始上传文件。

### 上传流程

1. 选择数据源
   从流水线配置的数据源类型中进行选择。目前，Dify 支持 4 种数据源
   文件上传（pdf, docx 等）、在线网盘（Google Drive, OneDrive 等）、在线文档（Notion)和 网页爬虫（Jina Reader 和 Firecrawl）。
   请前往 [Dify Marketplace](https://marketplace.dify.ai/) 获取更多数据源支持。
  
2. 填写文件处理相关参数和变量
   如果你在知识库流水线的编排过程中配置了用户输入字段，需要在这一步填写所需的参数和变量。完成填写后，点击预览分段可进行预览。  
   点击保存并处理完成知识库创建，进入数据处理阶段。
   <Warning>
   注意：分段结构与知识库流水线内保持一致，不会因用户输入的文件处理参数和变量而改变。
   </Warning>
  
3. 文档处理
   跟踪文档处理的进度。嵌入完成后，点击前往文档。

4. 查看文件列表
   点击前往文档，前往知识库文档界面。在这里，你可以浏览上传文件数量、处理进程和状态等。     
  
## 步骤五：管理和使用知识库

创建知识库后，你可以继续对其进行管理和优化，以确保它能为你的应用程序提供准确的的上下文信息。通过以下方式，您可以对知识库文件的进行更新、进行召回测试、修改流水线和修改知识库的属性等：

### 流水线
浏览编排的流水线，并对节点和配置进行修改。
<Warning>
你可前往[管理知识库文档](/zh-hans/guides/knowledge-base/knowledge-and-documents-maintenance/introduction)，了解更多内容。
</Warning>

## Step 2: Orchestrate Knowledge Pipeline

Think of this step as designing the workflow that is used to process different types of content. Here, you can visually build, adjust, and debug each node on this knowledge pipeline. 

### Interface Status

When entering the knowledge pipeline orchestration canvas, you’ll see:
- **Tab Status**: Documents, Retrieval Test, and Settings tabs will be grayed out and unavailable at the moment
- **Essential Steps**: You must complete knowledge pipeline orchestration and publishing before uploading files

`Screenshot`

### Pipeline Orchestration
Your starting point depends on the template choice you made previously. If you chose **Blank Knowledge Pipeline**, you'll see a canvas that contains Knowledge Base node only. There'll be a note with guide next to the node that walks you through the general steps of pipeline creation.

If you selected a specific pipeline template, there'll be a ready-to-use workflow that you can use or modify on the canvas right away. 

<Warning>
Explore Knowledge Pipeline Orchestration for step-by-step instructions.
</Warning>

### User Input Field

Create **User Input Field** forms to define and collect variables needed for pipeline execution. This customizable form allows users to fill in parameters when uploading files, accommodating different data sources or document processing requirements.

### Name the Knowledge Base

By default, the knowledge base name will be "Untitled + number", permissions are set to "Only me", and the icon will be an orange book. If you import it from a DSL file, it will use the saved icon.

Edit knowledge base inforamtion by clicking **Settings** in the left panel and fill in the information below:
- **Name & Icon**      
  Pick a name for your knowledge base.     
  Choose an emoji, upload an image, or paste an image URL as the icon of this knowledge base.
- **Knowledge Description**
  Provide a brief description of your knowledge base. This helps the AI better understand and retrieve your data. If left empty, Dify will apply the default retrieval strategy.
- **Permissions**     
  Select the appropriate access permissions from the dropdown menu.

## Step 3: Publish Knowledge Pipeline

After completing pipeline orchestration and debugging, click **Publish** and **Confirm** in the pop-up window. 

<Warning>
Important reminder: Once published, the chunk structure cannot be modified.
</Warning>

Once published, you can optionally use **Publish as a Knowledge Pipeline** to save it as a reusable template that will appear in the Customized section for future use.

<Warning>
Limitation: **Publish as a Knowledge Pipeline** is not available in Sandbox plan. To save and publish as a knowledge pipeline, please [upgrade](https://dify.ai/pricing) to professional or team plans. 
</Warning>

## Step 4: Upload Files

After publishing knowledge pipeline, there're two ways to upload files as below:
A: Click **Go to Documents** in the success notification to add or manage documents. After entering Documents page, click **Add File** to upload.

B: Click **Go to Add Documents** to add documents.

### Upload Process
1. Select Data Source
   Choose from the data source types configured in your pipeline. Dify currently supports 4 types of data sources: File Upload (pdf, docx, etc.), Online Drive (Google Drive, OneDrive, etc.), Online Doc (Notion), and Web Crawler (Jina Reader, Firecrawl). 
   Please visit [Dify Marketplace](https://marketplace.dify.ai/) to install additional data sources.

2. Fill in Processing Parameters and Preview
   If you configured user input fields during pipeline orchestration, users will need to fill in the required parameters and variables at this step. After completing the form, click **Preview** to see chunking results. Click **Save & Process** to complete knowledge base creation and start data processing.
   <Warning>
   Important reminder: Chunk structure remains consistent with the pipeline configuration and won't change with user input parameters.
   </Warning>

3. Process Documents
   Track the progress of document processing. After embedding is completed, click **Go to Document**.

4. Access Documents List
   Click **Go to Documents** to view the Documents page, where you can browse all uploaded file, processing status, etc.  

## Step 5: Manage and Use Knowledge Base

After creating your knowledge base, continuous management and optimization will provide accurate contextual information for your applications. These are the  options for follow-up maintenance. 

### Knowledge Pipeline
View and modify your orchestrated pipeline nodes and configurations. 

<Warning>
Find more information in Manage Knowledge.
</Warning>