---
title: ナレッジパイプラインの作成
---

ナレッジパイプラインは、生データを検索可能なナレッジベースへと変換するためのドキュメント処理ワークフローです。ワークフローを組み立てるように、さまざまな処理ノードやツールを視覚的に組み合わせて設定し、データ処理の精度や関連性を最適化できます。

一般的に、ナレッジパイプラインは次の4つの主要ステップで構成されます。

**データソース → データ抽出 → データ処理 → ナレッジストレージ**

それぞれのステップは特定の目的を担っています。各種ソースからコンテンツを収集し、処理可能なテキストに変換、検索に適した形へ整え、高速かつ正確な検索が可能なフォーマットで保存します。

Difyには特定の用途に最適化されたパイプラインテンプレートが組み込まれているほか、ゼロから独自のナレッジパイプラインを作成することも可能です。本章では、作成方法、全体の流れ、管理方法について解説します。

## ステップ1：ナレッジパイプラインを作成する

![ナレッジベースパイプラインの作成](/images/knowledge-base/create-knowledge-pipeline-1.png)

画面上部の「ナレッジベース」をクリックし、左メニューから「ナレッジベースパイプラインから作成」を選択します。開始方法は以下の3通りです。

### 1. ゼロから作成する

![ゼロから構築](/images/knowledge-base/create-knowledge-pipeline-2.png)

「空白のナレッジベースパイプライン」をクリックすると、カスタムパイプラインを一から構築できます。特定のデータソースやビジネス要件に合わせた処理戦略が必要な場合に選択します。

### 2. DSLファイルをインポートする

![DSLのインポート](/images/knowledge-base/create-knowledge-pipeline-3.png)

以前にエクスポートしたナレッジパイプラインのDSLファイルをインポートすれば、既存の設定を再利用したり、異なるシナリオ向けに修正を加えたりできます。画面左下の「DSLファイルからインポート」をクリックしてください。

Dify DSLはYAML形式の標準であり、AIアプリケーション設定（モデルパラメータ、プロンプト設計、ワークフローオーケストレーション等）を定義します。ナレッジパイプラインも同様のYAMLフォーマットでワークフローや構成を定義します。

ナレッジパイプラインDSLの主な内容：

| 項目 | 説明 |
|------|------|
| データソース | ローカルファイル、ウェブサイト、オンラインドキュメント、オンラインドライブ、ウェブクローラー |
| データ処理 | ドキュメント抽出、コンテンツ分割、クリーニング戦略 |
| ナレッジベース設定 | インデックス方式、検索設定、保存パラメータ |
| ノードオーケストレーション | ノードの配置および処理順序（ノードは処理の実行単位です） |
| ユーザー入力フォーム | カスタムパラメータ入力フィールド（設定がある場合） |

### 3. テンプレートから作成する

Difyは2種類のテンプレートを提供しています：**内蔵パイプライン**と**カスタマイズ済み**。どちらもカード上にナレッジベース名、説明、タグ（チャンキング構造など）が表示されます。

#### 内蔵パイプライン（Built-in Pipeline）

内蔵パイプラインはDify公式があらかじめ用意したナレッジベーステンプレートで、一般的なドキュメント構造やユースケースに最適化されています。使用したいテンプレートの「選択」をクリックするだけで導入できます。

![内蔵テンプレート](/images/knowledge-base/create-knowledge-pipeline-4.png)

##### テンプレートの種類

| テンプレート名 | チャンキング構造 | インデックス方式 | 検索設定 | 説明 |
|---------------|------------------|------------------|----------|------|
| 汎用分割モード（General Mode） | 汎用モード | 省リソース | 逆インデックス | ドキュメントを小さな段落へ分割し、ユーザークエリのマッチングと直接検索に利用されます。 |
| 親子分割モード（Parent-child Structure） | 親子モード | 高品質 | ハイブリッド検索 | ドキュメントを大きな親チャンクと小さな子チャンクに分割。親チャンクが子チャンクを包含し、検索精度と文脈整合性の両立を実現します。 |
| 簡単なQ&A（Simple Q&A） | Q&Aモード | 高品質 | ベクター検索 | 表形式データをQ&A形式へと変換し、質問マッチングを通じて迅速に回答が取得できます。 |
| 複雑なPDF（画像やテーブルを含む）（Complex PDF with Images & Tables） | 親子モード | 高品質 | ハイブリッド検索・重み付けスコア | PDF内の画像や表の内容も抽出可能です。 |
| LLMによる文脈強化（Contextual Enrichment Using LLM） | 親子モード | 高品質 | ハイブリッド検索・重み付けスコア | ドキュメントから画像や表を抽出し、LLMで説明注釈を自動生成して文脈を高度に強化します。 |
| Markdownへの変換（Convert to Markdown） | 親子モード | 高品質 | ハイブリッド検索・重み付けスコア | DOCX、XLSX、PPTXほかOfficeファイルをMarkdownへ変換し、情報処理を最適化します。※PDFは推奨されません。 |
| LLMによるQ&Aの自動生成（LLM Generated Q&A） | Q&Aモード | 高品質 | ベクター検索 | LLMによるQ&Aペアを原文テキストから自動生成し、質問マッチングで関連回答を検索します。 |

テンプレートカードの「詳細」ボタンをクリックすると、ポップアップでオーケストレーション構造、パイプライン説明、チャンキング構造を確認できます。内容を確認して「このナレッジベースパイプラインを使用」をクリックすれば、そのテンプレートでオーケストレーションを開始できます。

![テンプレート詳細](/images/knowledge-base/create-knowledge-pipeline-5.png)

#### カスタマイズ済み（Customized）

![カスタマイズ済みテンプレート](/images/knowledge-base/create-knowledge-pipeline-6.png)

カスタマイズ済みテンプレートはユーザーが作成・公開したナレッジパイプラインです。テンプレートの選択、DSLのエクスポート、詳細情報の確認が可能です。

![テンプレート操作](/images/knowledge-base/create-knowledge-pipeline-7.png)

テンプレートカードの「選択」または詳細プレビューから「このナレッジベースパイプラインを使用」を押せば、そのテンプレートでナレッジベースを作成できます。「…」メニューから、情報編集・DSLエクスポート・テンプレート削除も可能です。

## ステップ2：ナレッジパイプラインのオーケストレーション

本ステップは、異なる種類のコンテンツ処理ワークフローを設計する工程です。パイプライン上の各ノードを視覚的に構成・調整・デバッグできます。

### インターフェースの状態

オーケストレーションキャンバスに入ると、次の状態を確認できます。
- **タブの状態**： 「Documents（ドキュメント）」「Retrieval Test（検索テスト）」「Settings（設定）」タブはグレーアウトされ利用不可です。
- **必要ステップ**：パイプラインのオーケストレーションと公開が完了しないと、ファイルアップロードやその他機能は利用できません。

### パイプラインのオーケストレーション

選択したテンプレートによって、初期画面の表示が異なります。

**空白ナレッジベースパイプライン**を選択した場合は、ナレッジベースノードだけが配置されたキャンバスが表示され、ノード横のガイドの指示に従って作成を進めます。

![空白パイプライン](/images/knowledge-base/create-knowledge-pipeline-8.png)

**特定のパイプラインテンプレート**を選択した場合は、あらかじめワークフローが組まれた状態でキャンバスに表示され、すぐに利用・編集が可能です。

![テンプレートパイプライン](/images/knowledge-base/create-knowledge-pipeline-9.png)

<Warning>
詳細な操作手順は[ナレッジパイプラインのオーケストレーション]のガイドをご参照ください。
</Warning>

### ユーザー入力フィールド

![ユーザー入力フィールド](/images/knowledge-base/create-knowledge-pipeline-10.png)

**ユーザー入力フィールド**フォームを作成することで、パイプライン実行に必要な変数を定義・収集できます。カスタマイズ可能なこのフォームを利用すれば、ユーザーがファイルアップロード時にパラメータ入力でき、さまざまなデータソースや処理要件に柔軟に対応可能です。

### ナレッジベースの命名

![ナレッジベース命名](/images/knowledge-base/create-knowledge-pipeline-11.png)

デフォルトのナレッジベース名は「Untitled＋番号」、権限は「自分のみ」、アイコンはオレンジ色の書籍です。DSLファイルからインポートした場合は元のアイコンが適用されます。

左パネルの「設定」をクリックし、以下を設定してください。
- **名前とアイコン**  
  ナレッジベース名を決定します。絵文字選択、画像アップロード、画像URLによるアイコン設定が可能です。
- **ナレッジベース説明**  
  簡単な説明を記入してください。AIがデータをより適切に理解し検索できるようになります。未入力の場合はDifyのデフォルト検索戦略が使われます。
- **権限**  
  ドロップダウンから適切なアクセス権限を選択してください。

## ステップ3：ナレッジパイプラインの公開

オーケストレーション・デバッグが完了したら**公開**をクリックし、確認ダイアログで**確定**を押します。

![公開確認](/images/knowledge-base/create-knowledge-pipeline-12-1.png)
![公開成功](/images/knowledge-base/create-knowledge-pipeline-12.png)

<Warning>
**重要な注意点**：公開後はチャンキング構造を変更できません。チャンキング構造はナレッジベースの保存方式や検索戦略に影響し、データの一貫性とユーザー体験を確保するため、各ナレッジベースは**一種類のチャンキング構造**のみをサポートします。
</Warning>

![公開完了](/images/knowledge-base/create-knowledge-pipeline-13.png)

公開後、**ナレッジベースパイプラインとして公開**を選択すれば、カスタマイズ済みセクションに再利用可能なテンプレートとして登録できます。

<Warning>
**制限事項**：「ナレッジベースパイプラインとして公開」機能はSandboxプランでは利用できません。この機能を使用する場合は、ProfessionalまたはTeamプランへ[アップグレード](https://dify.ai/pricing)が必要です。
</Warning>

## ステップ4：ファイルのアップロード

ナレッジパイプライン公開後は、以下2通りの方法でファイルをアップロードできます。

A. 公開成功通知内の「ドキュメントへ移動」をクリックし、ドキュメントページで「ファイル追加」からアップロードします。

![方法A-1](/images/knowledge-base/create-knowledge-pipeline-14.png)
![方法A-2](/images/knowledge-base/create-knowledge-pipeline-15.png)

B. 「ドキュメント追加へ移動」をクリックしてファイルをアップロードします。

![方法B-1](/images/knowledge-base/create-knowledge-pipeline-16.png)
![方法B-2](/images/knowledge-base/create-knowledge-pipeline-17.png)

### アップロードの流れ

1. **データソースの選択**  
   パイプラインで設定したタイプから選択します。Difyは現在、4種類のデータソース（ファイルアップロード（PDF、DOCX等）、オンラインドライブ（Google Drive、OneDrive等）、オンラインドキュメント（Notion）、ウェブクローラー（Jina Reader、Firecrawl））をサポートしています。追加ソースは[Dify Marketplace](https://marketplace.dify.ai/)からインストール可能です。

2. **処理パラメータの入力・プレビュー**  
   パイプライン構築時にユーザー入力フィールドを設定していれば、ここで必要なパラメータ・変数を入力します。フォーム入力後、「プレビュー」をクリックすると分割結果を確認できます。「保存して処理」を押すとナレッジベースの作成とデータ処理が始まります。
   <Warning>
   **重要な注意点**：チャンキング構造はパイプライン設定で固定されており、ユーザー入力パラメータでは変更できません。
   </Warning>
   ![パラメータ入力](/images/knowledge-base/create-knowledge-pipeline-18.png)

3. **ドキュメント処理**  
   ドキュメント処理の進捗を追跡できます。埋め込み処理が完了したら「ドキュメントへ移動」をクリックしてください。
   ![処理進捗](/images/knowledge-base/create-knowledge-pipeline-19.png)

4. **ドキュメントリストの確認**  
   「ドキュメントへ移動」をクリックするとドキュメントページが表示され、アップロードしたファイルや処理状況が確認できます。
   ![ドキュメントリスト](/images/knowledge-base/create-knowledge-pipeline-20.png)

## ステップ5：ナレッジベースの管理と活用

ナレッジベース作成後は、継続的な管理・最適化により、アプリケーションに正確なコンテキスト情報を提供することが大切です。管理には以下のオプションがあります。

### ナレッジパイプライン

オーケストレーションしたパイプラインノードや設定の確認・修正が可能です。

<Warning>
詳細は[ナレッジ管理]のガイドをご参照ください。
</Warning>

![ナレッジ管理](/images/knowledge-base/create-knowledge-pipeline-21.png)

{/*
Contributing Section
DO NOT edit this section!
It will be automatically generated by the script.
*/}

---

[Edit this page](https://github.com/langgenius/dify-docs/edit/main/ja-jp/guides/knowledge-base/knowledge-pipeline/create-from-knowledge-pipeline.mdx) | [Report an issue](https://github.com/langgenius/dify-docs/issues/new?template=docs.yml)