---
title: Code Execution
---

When preset nodes aren't enough, the Code node lets you write custom Python or JavaScript to handle complex data transformations, calculations, and logic within your workflow.

This node is your escape hatch for scenarios where you need precise control over data processing. Whether you're parsing complex JSON structures, performing mathematical calculations, or combining data from multiple sources, the Code node gives you the full power of programming languages.

<img src="https://assets-docs.dify.ai/dify-enterprise-mintlify/en/guides/workflow/node/9969aa1bc1912aebe366f5d8f5dde296.png" width="400"/>

## Configuration

To use data from other nodes, define variable names in the `input variables` section first. Then reference these variables in your code. Check out our [Variable References](/en/guides/workflow/variables) guide for details.

## Common Use Cases

The Code node excels at tasks that require custom logic or data manipulation:

### Parsing Complex Data

APIs often return nested JSON with data buried several layers deep. Instead of chaining multiple nodes, write a simple script to extract exactly what you need:

```python
def main(http_response: str) -> dict:
    import json
    data = json.loads(http_response)
    return {
        # Don't forget to declare 'result' in output variables
        'result': data['data']['name'] 
    }
```

### Mathematical Operations

Need statistical analysis or complex calculations? The Code node handles math that preset nodes can't:

```python
def main(x: list) -> dict:
    return {
        # Calculate variance
        'result': sum([(i - sum(x) / len(x)) ** 2 for i in x]) / len(x)
    }
```

### Combining Data Sources

Merge results from multiple knowledge retrievals, API calls, or database queries:

```python
def main(knowledge1: list, knowledge2: list) -> dict:
    return {
        # Combine multiple data sources
        'result': knowledge1 + knowledge2
    }
```

## Self-Hosted Setup

Running Dify locally? You'll need to start the sandbox service for secure code execution. This requires Docker and prevents malicious code from affecting your system.

Find the sandbox configuration [here](https://github.com/langgenius/dify/tree/main/docker/docker-compose.middleware.yaml) or start it directly:

```bash
docker-compose -f docker-compose.middleware.yaml up -d
```

## Security

Your code runs in a strict sandbox that blocks potentially dangerous operations. You can't access the file system, make network requests, or execute system commands. This keeps your deployment secure while still giving you programming flexibility.

## Advanced Features

**Retry on Failure**: Automatically retry failed code executions up to 10 times with configurable intervals (max 5000ms). Useful for handling temporary issues.

![](https://assets-docs.dify.ai/2024/12/9fdd5525a91dc925b79b89272893becf.png)

**Error Handling**: Set up backup paths when your code fails. Your workflow can continue running even if the code encounters problems.

1. Enable "Error Handling" in the code node
2. Choose your error handling strategy

![Code Error handling](https://assets-docs.dify.ai/2024/12/58f392734ce44b22cd8c160faf28cd14.png)

See our [Error Handling guide](/en/guides/workflow/error-handling) for more details.

## Troubleshooting

**Can't save your code?** 

Your code might be triggering security filters. Avoid operations like:

```python
def main() -> dict:
    return {
        "result": open("/etc/passwd").read(),  # Don't do this
    }
```

This attempts to read system files, which is blocked for security reasons. Cloudflare WAF automatically filters out potentially dangerous code. Check your browser's Network tab if you suspect your code is being blocked.

![Cloudflare WAF](https://assets-docs.dify.ai/2024/12/ad4dc065c4c567c150ab7fa7bfd123a3.png)

{/*
Contributing Section
DO NOT edit this section!
It will be automatically generated by the script.
*/}

---

[Edit this page](https://github.com/langgenius/dify-docs/edit/main/en/guides/workflow/node/code.mdx) | [Report an issue](https://github.com/langgenius/dify-docs/issues/new?title=Documentation%20Issue%3A%20&body=%23%23%20Issue%20Description%0A%3C%21--%20Please%20briefly%20describe%20the%20issue%20you%20found%20--%3E%0A%0A%23%23%20Page%20Link%0Ahttps%3A%2F%2Fgithub.com%2Flanggenius%2Fdify-docs%2Fblob%2Fmain%2Fen/guides/workflow/node%2Fcode.mdx%0A%0A%23%23%20Suggested%20Changes%0A%3C%21--%20If%20you%20have%20specific%20suggestions%20for%20changes%2C%20please%20describe%20them%20here%20--%3E%0A%0A%3C%21--%20Thank%20you%20for%20helping%20improve%20our%20documentation%21%20--%3E)

